# ğŸŒ± Clima-MundoVerde

Clima-MundoVerde es una API REST desarrollada en TypeScript y Express que permite consultar datos climÃ¡ticos en tiempo real desde OpenWeather API. Los resultados se almacenan en Supabase (PostgreSQL) para fines de auditorÃ­a y anÃ¡lisis posteriores.

## ğŸ“¦ TecnologÃ­as Utilizadas

- Node.js + Express
- TypeScript
- TypeORM
- Supabase (PostgreSQL gestionado)
- OpenWeather API
- Axios
- Dotenv
- CORS
- JWT (para autenticaciÃ³n)
- Jest + Supertest (para testing)

## ğŸ”§ Requisitos Previos

- Node.js â‰¥ 18.x
- Docker Compose
- Cuenta gratuita en OpenWeatherMap (para obtener una API key)

## ğŸš€ InstalaciÃ³n y EjecuciÃ³n

### Clonar el repositorio
```bash
git clone https://github.com/EZMayk/MundoVerde.git
cd MundoVerde
```

### InstalaciÃ³n de dependencias
```bash
npm install
```

### ConfiguraciÃ³n del entorno
Crea un archivo `.env` en la raÃ­z del proyecto con el siguiente contenido:
```env
DB_HOST=aws-0-us-east-2.pooler.supabase.com
DB_PORT=6543
DB_USERNAME=postgres.xsdzrbphlibhwmegavsc
DB_PASSWORD=Menendez2025*_*
DB_DATABASE=postgres
PORT=3000
OPENWEATHER_API_KEY=fbf0bedef7d799633876a3253f1e575a
OPENWEATHER_BASE_URL=https://api.openweathermap.org/data/2.5/weather
```

### InstalaciÃ³n de JWT
```bash
npm install jsonwebtoken
npm install --save-dev @types/jsonwebtoken
```

### InstalaciÃ³n de Jest para pruebas
```bash
npm install --save-dev jest ts-jest @types/jest supertest @types/supertest
```
### incia la configuracion de jest
```
npx ts-jest config:init
```

### instalacion de supertest para simular peticiones HTTP a tu servidor Express para los test de routes.
```bash
npm install --save-dev supertest @types/supertest
```

### EjecuciÃ³n del proyecto
```bash
npm run dev
```
El servidor estarÃ¡ disponible en: `http://localhost:3000`

## ğŸ“‚ Estructura Principal del Proyecto
```text
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ dtos/
â”‚   â”œâ”€â”€ entities/
â”‚   â”œâ”€â”€ middlewares/
â”‚   â”œâ”€â”€ repositories/
â”‚   â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ app.ts
â”œâ”€â”€ tests/
â”œâ”€â”€ .env
â”œâ”€â”€ .gitignore
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ README.MD
â””â”€â”€ tsconfig.json
```

## ğŸ“¡ Endpoints Disponibles

### Consultar Clima Actual
- **MÃ©todo:** GET  
- **URL:** `/api/consulta-clima?ciudad=Guayaquil`

#### ParÃ¡metros:
- `ciudad` (string) â†’ Nombre de la ciudad a consultar.

âœ”ï¸ Este endpoint:
- Consulta la API de OpenWeather.
- Guarda los datos en Supabase.
- Registra la consulta en la base de datos.
- Almacena un log de la consulta.

### Obtener Fuentes ClimÃ¡ticas
- **MÃ©todo:** GET  
- **URL:** `/api/fuentes`

### Obtener Logs de Consultas
- **MÃ©todo:** GET  
- **URL:** `/api/logs`

#### ParÃ¡metros opcionales:
- `ciudad` â†’ Filtra por ciudad.
- `resultado` â†’ Filtra por "Ã©xito" o "error".
- `fuente` â†’ Filtra por fuente climÃ¡tica.

#### Ejemplo sin filtros:
```http
GET http://localhost:3000/api/logs
```

#### Ejemplo con filtros:
```http
GET http://localhost:3000/api/logs?ciudad=Quito&resultado=Ã©xito
```

## âœ… Pruebas Unitarias y de IntegraciÃ³n
Para ejecutar las pruebas:
```bash
npm test
```

## ğŸ“œ Scripts disponibles en package.json
```json
"scripts": {
  "dev": "nodemon --exec ts-node src/app.ts",
  "start": "ts-node-dev src/app.ts",
  "test": "jest"
}
```
